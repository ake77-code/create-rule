import d from"node:path";import*as x from"@clack/prompts";import{writeFile as C}from"node:fs/promises";import{existsSync as y}from"node:fs";function w(u){return u==null?[]:Array.isArray(u)?u:[u]}function A(u,r,t,i){var l,a=u[r],s=~i.string.indexOf(r)?t==null||t===!0?"":String(t):typeof t=="boolean"?t:~i.boolean.indexOf(r)?t==="false"?!1:t==="true"||(u._.push((l=+t,l*0===0?l:t)),!!t):(l=+t,l*0===0?l:t);u[r]=a==null?s:Array.isArray(a)?a.concat(s):[a,s]}function p(u,r){u=u||[],r=r||{};var t,i,l,a,s,o={_:[]},e=0,n=0,b=0,c=u.length;const m=r.alias!==void 0,h=r.unknown!==void 0,E=r.default!==void 0;if(r.alias=r.alias||{},r.string=w(r.string),r.boolean=w(r.boolean),m)for(t in r.alias)for(i=r.alias[t]=w(r.alias[t]),e=0;e<i.length;e++)(r.alias[i[e]]=i.concat(t)).splice(e,1);for(e=r.boolean.length;e-- >0;)for(i=r.alias[r.boolean[e]]||[],n=i.length;n-- >0;)r.boolean.push(i[n]);for(e=r.string.length;e-- >0;)for(i=r.alias[r.string[e]]||[],n=i.length;n-- >0;)r.string.push(i[n]);if(E){for(t in r.default)if(a=typeof r.default[t],i=r.alias[t]=r.alias[t]||[],r[a]!==void 0)for(r[a].push(t),e=0;e<i.length;e++)r[a].push(i[e])}const F=h?Object.keys(r.alias):[];for(e=0;e<c;e++){if(l=u[e],l==="--"){o._=o._.concat(u.slice(++e));break}for(n=0;n<l.length&&l.charCodeAt(n)===45;n++);if(n===0)o._.push(l);else if(l.substring(n,n+3)==="no-"){if(a=l.substring(n+3),h&&!~F.indexOf(a))return r.unknown(l);o[a]=!1}else{for(b=n+1;b<l.length&&l.charCodeAt(b)!==61;b++);for(a=l.substring(n,b),s=l.substring(++b)||e+1===c||(""+u[e+1]).charCodeAt(0)===45||u[++e],i=n===2?[a]:a,b=0;b<i.length;b++){if(a=i[b],h&&!~F.indexOf(a))return r.unknown("-".repeat(n)+a);A(o,a,b+1<i.length||s,r)}}}if(E)for(t in r.default)o[t]===void 0&&(o[t]=r.default[t]);if(m)for(t in o)for(i=r.alias[t]||[];i.length>0;)o[i.shift()]=o[t];return o}function D(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var g={exports:{}},B;function O(){if(B)return g.exports;B=1;let u=process||{},r=u.argv||[],t=u.env||{},i=!(t.NO_COLOR||r.includes("--no-color"))&&(!!t.FORCE_COLOR||r.includes("--color")||u.platform==="win32"||(u.stdout||{}).isTTY&&t.TERM!=="dumb"||!!t.CI),l=(o,e,n=o)=>b=>{let c=""+b,m=c.indexOf(e,o.length);return~m?o+a(c,e,n,m)+e:o+c+e},a=(o,e,n,b)=>{let c="",m=0;do c+=o.substring(m,b)+n,m=b+e.length,b=o.indexOf(e,m);while(~b);return c+o.substring(m)},s=(o=i)=>{let e=o?l:()=>String;return{isColorSupported:o,reset:e("\x1B[0m","\x1B[0m"),bold:e("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"),dim:e("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"),italic:e("\x1B[3m","\x1B[23m"),underline:e("\x1B[4m","\x1B[24m"),inverse:e("\x1B[7m","\x1B[27m"),hidden:e("\x1B[8m","\x1B[28m"),strikethrough:e("\x1B[9m","\x1B[29m"),black:e("\x1B[30m","\x1B[39m"),red:e("\x1B[31m","\x1B[39m"),green:e("\x1B[32m","\x1B[39m"),yellow:e("\x1B[33m","\x1B[39m"),blue:e("\x1B[34m","\x1B[39m"),magenta:e("\x1B[35m","\x1B[39m"),cyan:e("\x1B[36m","\x1B[39m"),white:e("\x1B[37m","\x1B[39m"),gray:e("\x1B[90m","\x1B[39m"),bgBlack:e("\x1B[40m","\x1B[49m"),bgRed:e("\x1B[41m","\x1B[49m"),bgGreen:e("\x1B[42m","\x1B[49m"),bgYellow:e("\x1B[43m","\x1B[49m"),bgBlue:e("\x1B[44m","\x1B[49m"),bgMagenta:e("\x1B[45m","\x1B[49m"),bgCyan:e("\x1B[46m","\x1B[49m"),bgWhite:e("\x1B[47m","\x1B[49m"),blackBright:e("\x1B[90m","\x1B[39m"),redBright:e("\x1B[91m","\x1B[39m"),greenBright:e("\x1B[92m","\x1B[39m"),yellowBright:e("\x1B[93m","\x1B[39m"),blueBright:e("\x1B[94m","\x1B[39m"),magentaBright:e("\x1B[95m","\x1B[39m"),cyanBright:e("\x1B[96m","\x1B[39m"),whiteBright:e("\x1B[97m","\x1B[39m"),bgBlackBright:e("\x1B[100m","\x1B[49m"),bgRedBright:e("\x1B[101m","\x1B[49m"),bgGreenBright:e("\x1B[102m","\x1B[49m"),bgYellowBright:e("\x1B[103m","\x1B[49m"),bgBlueBright:e("\x1B[104m","\x1B[49m"),bgMagentaBright:e("\x1B[105m","\x1B[49m"),bgCyanBright:e("\x1B[106m","\x1B[49m"),bgWhiteBright:e("\x1B[107m","\x1B[49m")}};return g.exports=s(),g.exports.createColors=s,g.exports}var v=O();const k=D(v),{blue:q,blueBright:G,cyan:$,green:_,greenBright:U,magenta:V,red:z,redBright:H,reset:J,yellow:R}=k,f=p(process.argv.slice(2),{alias:{h:"help",t:"template"},boolean:["help","overwrite"],string:["template"]}),j="https://cursor.directory/api",M=`Usage: llm-rules [OPTION]... [DIRECTORY]

\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684 LLM Rules \u914D\u7F6E\u6587\u4EF6\u3002
\u65E0\u53C2\u6570\u65F6\uFF0C\u4EE5\u4EA4\u4E92\u6A21\u5F0F\u542F\u52A8 CLI\u3002

Options:
  -t, --template NAME        use a specific template

\u9009\u62E9\u7F16\u8F91\u5668:
${R("trae     trae")}
${_("cursor         cursor")}
${$("windsurf       windsurf")}
`;async function S(){const u=f._[0]?T(String(f._[0])):void 0,r=f.template,t=f.overwrite;if(f.help){console.log(M);return}const i=()=>x.cancel("\u64CD\u4F5C\u88AB\u53D6\u6D88");let l;if(u==="trae"?l="trae":l=await x.select({message:"\u9009\u62E9\u4F60\u8981\u5728\u4EC0\u4E48\u7F16\u8F91\u5668\u4E0B\u521B\u9020rule",options:[{value:"trae",label:"trae"},{value:"cursor",label:"cursor"},{value:"windsurf",label:"windsurf"}]}),x.isCancel(l))return i();let a=r;if(!a){const n=await x.text({message:"\u4F60\u8981\u521B\u5EFA\u7684rule",validate(b){if(b.length===0)return"rule\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A";if(b.includes("/"))return"rule\u540D\u79F0\u4E0D\u80FD\u5305\u542B /"}});if(x.isCancel(n))return i();a=n}const s=L(a),o=await I(s),e=P(l,s);if(y(e)){const n=t?"yes":await x.select({message:`\u76EE\u6807\u6587\u4EF6 "${e}"
           \u5DF2\u7ECF\u5B58\u5728. \u662F\u5426\u8981\u7EE7\u7EED:`,options:[{label:"\u53D6\u6D88\u64CD\u4F5C",value:"no"},{label:"\u8986\u76D6\u6587\u4EF6",value:"yes"}]});if(x.isCancel(n))return i();switch(n){case"yes":break;case"no":i();return}}await C(e,o),console.log(`\u6210\u529F\u4FDD\u5B58\u89C4\u5219\u5230: ${e}`)}function P(u,r){switch(u){case"trae":return d.join(process.cwd(),".trae","rules","project_rules.md");case"cursor":return d.join(process.cwd(),".cursor","rules",`${r}.mdc`);case"windsurf":return d.join(process.cwd(),".windsurfrules");default:throw new Error("\u4E0D\u652F\u6301\u7684\u7F16\u8F91\u5668\u7C7B\u578B")}}function T(u){return u.trim().replace(/\/+$/g,"")}async function I(u){const r=await fetch(`${j}/${u}`);if(!r.ok)throw new Error(`Failed to fetch from API: ${r.statusText}`);const t=(await r.json()).data;if(!t)throw new Error(`\u672A\u627E\u5230\u5BF9\u5E94\u7684\u89C4\u5219: ${u}`);return`---
  description: ${t.title}
  globs:
  alwaysApply: false
  ---
  ${t.content.trim()}`}function L(u){if(u.startsWith("http://")||u.startsWith("https://")){const r=u.split("/");return r[r.length-1]}return u}S().catch(u=>{console.error(u)});
